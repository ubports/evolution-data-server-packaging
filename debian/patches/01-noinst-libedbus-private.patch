From b1ccbf79a6b43f64a7dd93ef3d3470e45e7b12e5 Mon Sep 17 00:00:00 2001
From: Emilio Pozuelo Monfort <pochu@debian.org>
Date: Fri, 29 May 2015 18:12:45 +0200
Subject: [PATCH] Revert installation of libedbus-private.so

That was done in a2790163 to fix a problem in Windows.

Installing libedbus-private.so only causes us issues:

It is a private library, with no SONAME. We don't want to ship it in
a libedbus-private0 package because it doesn't have any rdeps outside
of e-d-s, and it doesn't have any guaranteed stability. Also, shipping
it inside e.g. evolution-data-server (as happened in 3.16.2-2) isn't
very helpful because dh_makeshlibs doesn't detect it as it doesn't have
a SONAME, which means it doesn't get a shlibs file, and the libs that
depend on it (e.g. libecal-1.2.so, libedataserver-1.2.so) don't end
with a dependency on evolution-data-server, leading to undefined references
at runtime.

We could remove the -avoid-version switch so it gets a SONAME, a shlibs
file and the other libs get dependencies, but then we'd need to restrict
that so that the dependencies are very tight, given the unstable nature
of this private library. Those tight dependencies would make different
versions of the libraries, e.g. libecal-1.2-7 and libecal-1.2-8
uninstallable.

However we can just revert that as it happened to fix an issue in Windows,
and let the libraries embed the code as it was happening before.

Signed-off-by: Emilio Pozuelo Monfort <pochu@debian.org>
---
 private/Makefile.am | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/private/Makefile.am b/private/Makefile.am
index a96d525..0ff1d13 100644
--- a/private/Makefile.am
+++ b/private/Makefile.am
@@ -200,7 +200,7 @@ BUILT_SOURCES = \
 	$(GENERATED_DBUS_SUBPROCESS_BACKEND) \
 	$(NULL)
 
-privsolib_LTLIBRARIES = libedbus-private.la
+noinst_LTLIBRARIES = libedbus-private.la
 
 # We omit AM_CPPFLAGS -- which is mostly warning flags -- since
 # we have no control over the C code generated by gdbus-codegen.
@@ -225,7 +225,6 @@ libedbus_private_la_LIBADD = \
 	$(NULL)
 
 libedbus_private_la_LDFLAGS = \
-	-avoid-version \
 	$(NO_UNDEFINED) \
 	$(CODE_COVERAGE_LDFLAGS) \
 	$(NULL)
-- 
2.1.4

